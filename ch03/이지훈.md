# 3장 홈페이지 최적화 - 쿠키 전까지

## 분석툴

- Coverage 패널
  - 크롬 개발자 도구에 있음
  - 페이지 로딩 시 사용되지 않은 CSS와 JavaScript 코드를 찾아내는데 사용
  - 이를 통해 불필요한 코드를 제거하고, 웹 사이트의 로딩 속도를 개선
- Squoosh
  - 구글에서 만든 무료 온라인 이미지 압축 도구로, 개발자들이 빠르게 이미지를 최적화를 하는데 사용
  - WebP, JPEG, PNG 등 다양한 형식에서 이미지를 압축하며, 품질을 손상시키지 않으면서 이미지 용량을 줄일 수 있음
  - 이는 웹 사이트에서 이미지 로딩 속도를 향상시키는데 도움이 됨
- PurgeCSS
  - 미사용 CSS를 제거하는 도구로, 프로젝트의 CSS 파일 크기를 줄여 로딩 속도를 개선
  - HTML, JavaScript 및 템플릿 파일에서 사용되지 않는 CSS 클래스를 찾아 필요 없는 부분을 제거하는 작업을 수행

## 이미지 지연 로딩

- 이미지 지연 로딩은 웹 페이지 로딩 속도를 향상시키기 위해 사용되며, 뷰포트에 이미지가 표시될 때 혹은 직전에 이미지를 로드하는 방식을 의미.
- Intersection Observer API를 활용
- Intersection Observer API는 특정 요소가 화면에 들어왔을 때 콜백 함수를 호출하여 성능 면에서 효율적인 처리를 가능하게 함.
- 주로 사용되는 값은 요소가 뷰포트 내에 들어왔는지 여부를 나타내는 isIntersecting 플래그
- 네트워크 분석은 웹 페이지 로딩 시 작동하는 다양한 리소스를 살펴보고, 성능 최적화를 위해 사용되는 도구.
- 사용자 경험을 최적화하고 리소스의 우선순위 조절을 위해 Fast 3G, Slow 3G 등의 네트워크 프로파일을 사용
- 업로드와 다운로드 속도가 각각 설정되어 있으며, 커스텀 설정을 통해 더 세부적인 조절이 가능
- 이미지 지연 로딩 프로세스를 효과적으로 구현하기 위해, 이미지 정보를 data-src 속성을 사용하여 저장하고, Intersection Observer 콜백 함수에서 이미지를 로드하도록 처리해야 하고 처리가 완료되면 unobserve를 반드시 호출해야 함

## 느린 사이즈 최적화

- 이미지 최적화는 웹 페이지 로딩 속도를 향상시키는데 중요한 역할을 함
- 이미지 최적화의 목적은 이미지 크기(가로, 세로 및 파일 용량)를 줄여 다운로드 시간을 단축하고 브라우저에서 렌더링을 빠르게 수행하는 것
- 이미지 최적화를 위해 고려해야 할 점
- 이미지 포맷: 비트맵, PNG, JPG, WebP 등 다양한 이미지 포맷이 있으며, 이들 중 적절한 포맷을 선택해야 포맷에 따라 파일 크기, 화질, 호환성 등이 달라짐
- 이미지 압축: 이미지 포맷별로 무손실 및 손실 압축 방식을 사용할 수 있음. 높은 압축률은 이미지 용량을 줄이고 다운로드 시간을 단축하나, 화질이 떨어질 수 있음, 일반적으로 70~80의 압축률이 적절하다고 책에서 설명함
- Sqoosh를 사용한 이미지 변환: Sqoosh는 온라인 이미지 최적화 도구로, 다양한 포맷 및 압축 옵션을 제공
- 호환성 고려: 특정 이미지 포맷이 모든 브라우저에서 지원되지 않는 경우, picture 태그와 src 태그를 사용하여 호환성을 고려한 이미지 최적화를 구현

## 동영상과 폰트 최적화

- 동영상 최적화
  - 비디오 포맷 선택: 빠르게 호환되고 압축이 잘되는 포맷들을 사용 => H.264 및 WebM과 같은 고효율 비디오 코덱을 사용
  - 적절한 해상도 및 비트레이트: 사용자의 기기에 맞춰 적절한 해상도 및 비트레이트를 선택해서 파일 크기를 줄이고 불필요한 데이터 사용을 피해야 함
  - 적응형 스트리밍: 다양한 통신 환경 및 기기에서 원활하게 동영상을 재생할 수 있도록 적응형 스트리밍을 사용합니다( MPEG-DASH, HLS )
  - 지연 로딩: 동영상을 지연 로딩하여 뷰포트에 들어오기 전에 비디오 파일을 로드하지 않고,Intersection Observer를 동영상에 적용할 수 있음
- 폰트 최적화
  - 웹폰트 선택: 사용자가 웹페이지에 방문하면 폰트를 다운로드하여 렌더링하는데 시간이 걸리므로, 웹폰트 사용을 신중하게 고려 후 시스템 폰트를 사용해도 됨
  - 서브셋 패키징: 사용하지 않는 글리프를 포함한 폰트를 다운로드하는 것은 매우 비효율적이므로 서브셋 패키징을 통해 필요한 글리프만 포함한 웹폰트를 사용하면 파일 크기를 줄일 수 있다.
  - 웹폰트 형식 선택: 브라우저와 호환성을 고려하여 최신 웹폰트 형식인 WOFF2나 WOFF를 사용
  - 폰트 로딩 전략: 웹페이지 로딩 동안 사용자에게 폰트를 보여주는 전략을 선택 => 로딩 CSS 속성인 font-display를 사용하며, 주요 옵션에는 'auto', 'swap', 'block', 'fallback'와 'optional'이 있음
  - FOUT(Flash Of Unstyled Text)와 FOIT(Flash Of Invisible Text) 방식을 제어

