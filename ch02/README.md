# 2장 올림픽 통계 서비스 최적화

## 쟁크(Jank)

- 발생하는 이유
  - 애니메이션을 처리하기 위해 브라우저또는 디바이스가 충분한 성능을 가지고있지 않기때문에
  - 과도한 리소스가 사용될때
  - JS 실행이 메인 스레드를 블로킹하거나, 동시에 처리할 수 있는 작업의 양이 너무 많은 경우
- 해결하는 방법
  - 이미지 크기를 줄이거나, 리소스를 제거하거나, CSS 를 잘 활용해 부하를 줄이는 최적화를 진행
  - CSS 애니메이션 활용 : Transform 또는 opacity 를 사용
  - 비동기적인 작업 활용
  - 자원 로딩 순서를 조정(필요한 리소스가 모두 로드된 후에 애니메이션을 시작하도록)

## 브라우저 렌더링 과정

- DOM + CSSOM --> 렌더 트리 --> 레이 아웃 --> 페인트 --> 컴포지트
- DOM + CSSOM
  - DOM(Document Object Model)
    - HTML이 브라우저가 이해할 수 있는 형태로 변환하는 파싱 과정을 거쳐 요소간의 관계가 트리 구조로 표현 된 것
    - DOM 은 문서노드(웹페이지 전체), 요소노드(HTML 요소), 속성 노드(HTML 요소의 속성), 텍스트 노드(HTML 요소의 텍스트) 로 이루어짐
  - CSSOM(CSS Object Model)
    - CSS가 브라우저가 이해할 수 있는 형태로 변환하여 요소간의 관계가 트리 구조로 표현 된 것
    - 스타일규칙, 선택자, 선언, 스타일 속성, 스타일 값이 해당된다.
- 랜더 트리
  - DOM과 CSSOM의 결합으로 생성됨
  - 화면에 표시되는 각 요소의 레이아웃을 계산하는데 사용됨
  - display : none으로 설정되어 있는 화면에 표시되지 않는 요소는 렌더 트리 포함 X
- 레이 아웃 : 렌더 트리가 완성 되고 화면 구성 요소의 위치나 크기를 계산하고, 해당 위치에 요소를 배치하는 작업
- 페인트 : 레이아웃을 통해 화면에 요소의 위치와 크기를 잡아 놨으니, 색을 입히는 차례
- 컴포지트
  - 레이어들을 합성하는 작업
  - 페인트 단계에서 레이아웃을 쪼개서 그릴 수 있는데 그 다음 단계에 레이어를 하나로 합성

## 리플로우 & 리페인트

- 리플로우
  - 레이아웃의 변경으로 인해 웹 페이지의 구성 요소들이 재배치되는 과정
  - 성능에 영향을 많이 미침(작은 요소도)
- 리페인트
  - 스타일 변경으로 인해 웹 페이지의 일부 또는 전체가 다시 그려지는 과정
  - 리플로우 만큼의 성능영향도는 없지만 연속적으로 발생하면 성능문제를 야기할 수 있음

## 애니메이션 최적화하는 방법

- 레이아웃 트리 외 배치를 이용해 레이아웃에 영향을 미치지 않도록 하고 변화
- transform 과같은 속성을 사용
- will-change 사용(책에 있지않지만 방법이 될 수 있어서 기록)
  ```typescript
  .element {
       position: absolute;
       will-change: transform;
       transform: translateX(100px);
   }
  ```
  - mozilla 에서 권장하지만, 잘 사용하는 5가지 방법이라고 되어있는 부분이있음.
    - 너무 많은 요소에 will-change를 적용하지 마라.
    - 아껴서 사용하라.
    - 최적화하기 위해 서둘러 will-change를 적용하지 마라.
    - 브라우저가 작업할 시간을 충분히 줘라.
    - will-change 속성은 스택 Context가 미리 생기기 때문에 요소의 시각적인 모양에 영향을 미칠 수 있다.
  - 가끔 사용하면 효율적이지만 자주 사용하면 성능적으로 더 문제가 될 수 있음.

<hr/>

## 컴포넌트 지연 로딩

- 지연로딩의 장점 : 최초 페이지를 로드 할 때 필요없는 모달과 관련된 코드가 번들에 포함x => JS 실행 타이밍이 빨라져 화면이 더 빨리 표시됨
- 지연로딩의 단점: 모달을 띄울때 사용하면 로드가 완료되어야 모달이 띄어져서 약간의 지연이 생김, 초기접근시간(FCP)가 늦어짐
- 컴포넌트 지연로딩
  - Web 어플리케이션 내에서 컴포넌트를 필요로 할 때 동적으로 로드
  - 대규모 웹 애플리케이션에서 많은 수의 컴포넌트를 빠르게 로드하기 위해서 사용
  - FCP 점수를 향상시킴
  - 리소스 절약에 도움이됨 => 사용자가 특정 기능, 뷰를 요청할때만 컴포넌트를 로드하기 때문에
  - 단점 : 사용자가 컴포넌트를 요청할때 로딩 시간이 추가되어 사용자 경험에 지연이 있을 수 있음.
